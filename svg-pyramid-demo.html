<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人口ピラミッド SVG描画エンジン デモ</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: bold;
            color: #555;
        }
        
        .control-group select,
        .control-group input,
        .control-group button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .control-group button {
            background: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        
        .control-group button:hover {
            background: #0056b3;
        }
        
        .control-group button.active {
            background: #28a745;
        }
        
        #pyramid-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            min-height: 600px;
            margin-bottom: 20px;
            overflow: auto;
        }
        
        .info-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .status {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .demo-data {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>人口ピラミッド SVG描画エンジン デモ</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>スケールモード</label>
                <select id="scaleMode" onchange="changeScaleMode()">
                    <option value="auto">自動</option>
                    <option value="fixed">固定</option>
                    <option value="percentage">比率</option>
                </select>
            </div>

            <div class="control-group">
                <label>ユニットサイズ</label>
                <button id="uin">＋ 拡大</button>
                <button id="uout">－ 縮小</button>
                <div style="display: flex; align-items: center; gap: 15px; margin-top: 5px;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="unitType" id="unitsize" value="width" checked>
                        <span>幅</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="unitType" id="barheight" value="height">
                        <span>高さ</span>
                    </label>
                </div>
                <!--div style="display: flex; align-items: center; gap: 10px;">
                    <input type="range" id="barHeightSlider" min="3" max="12" value="6" step="0.5" style="width: 100px;">
                    <span id="barHeightValue">6px</span>
                    <button onclick="applyHybridResize()">適用</button>
                </div-->
            </div>
            
            <div class="control-group">
                <label>ピラミッドサイズ</label>
                <button id="zin">＋ 拡大</button>
                <button id="zout">－ 縮小</button>
                <label>　倍率<span id="scaleLabel">100%</span></label>
                <!--select id="pyramidSize" onchange="changePyramidSize()">
                    <option value="0.5">小 (50%)</option>
                    <option value="1" selected>標準 (100%)</option>
                    <option value="1.5">大 (150%)</option>
                    <option value="2">特大 (200%)</option>
                </select-->
            </div>
            
            <div class="control-group">
                <label>デモデータ</label>
                <select id="demoData" onchange="loadDemoData()">
                    <option value="shi" selected>横浜市 2022年１月１日）</option>
                    <option value="aoba">青葉区 2022年１月１日</option>
                    <option value="nishi">西区 2022年１月１日</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>オプション</label>
                <button onclick="toggleNumbers()">人数表示切替</button>
                <button onclick="toggleGrid()">グリッド切替</button>
            </div>
            
        </div>
        
        <div id="pyramid-container"></div>
        
        <div class="info-panel">
            <div class="status" id="status">SVG描画エンジンが有効です</div>
            <p><strong>使用方法:</strong></p>
            <ul>
                <li>「描画エンジン」ボタンでSVG描画とHTML描画を切り替えられます</li>
                <li>「スケールモード」で人口数に応じたバーの長さの計算方法を変更できます</li>
                <li>「ピラミッドサイズ」で全体のサイズを調整できます</li>
                <li>「デモデータ」で異なる人口構造のサンプルを表示できます</li>
            </ul>
        </div>
    </div>

    <!-- デモ用のサンプルデータ -->
    <div class="demo-data">
        <!-- 横浜市 2022年 -->
        <script id="shi-data" type="application/json">
        {"last_modified":"2022-01-18 15:06:56 +0900","kijunbi":"令和4年1月1日現在","shiku":"横浜市","source_url":"https://www.city.yokohama.lg.jp/city-info/yokohamashi/tokei-chosa/portal/jinko/nenrei/suikei.files/22_hyo22.xlsx","kakusai_betsu":[["総数","3,772,029","1,862,325","1,909,704"],["0","24,988","12,860","12,128"],["1","24,952","12,832","12,120"],["2","25,867","13,195","12,672"],["3","27,072","13,892","13,180"],["4","27,577","14,100","13,477"],["5","28,490","14,517","13,973"],["6","29,554","15,098","14,456"],["7","29,481","15,159","14,322"],["8","29,802","15,354","14,448"],["9","30,601","15,608","14,993"],["10","30,197","15,500","14,697"],["11","31,250","15,985","15,265"],["12","31,268","15,956","15,312"],["13","31,495","16,303","15,192"],["14","31,556","16,292","15,264"],["15","31,804","16,406","15,398"],["16","30,403","15,560","14,843"],["17","32,060","16,428","15,632"],["18","32,871","16,820","16,051"],["19","35,070","17,672","17,398"],["20","37,610","19,290","18,320"],["21","39,749","20,156","19,593"],["22","40,118","20,349","19,769"],["23","42,984","21,773","21,211"],["24","41,257","20,655","20,602"],["25","41,092","20,918","20,174"],["26","40,010","20,382","19,628"],["27","40,856","20,651","20,205"],["28","38,625","19,664","18,961"],["29","38,520","19,631","18,889"],["30","38,845","19,803","19,042"],["31","38,882","19,845","19,037"],["32","38,352","19,472","18,880"],["33","40,999","20,807","20,192"],["34","40,681","20,844","19,837"],["35","41,357","21,018","20,339"],["36","43,387","21,895","21,492"],["37","45,360","23,272","22,088"],["38","46,033","23,425","22,608"],["39","46,089","23,488","22,601"],["40","46,627","23,704","22,923"],["41","47,821","24,080","23,741"],["42","49,657","25,277","24,380"],["43","51,445","26,139","25,306"],["44","53,343","27,199","26,144"],["45","55,558","28,085","27,473"],["46","57,328","29,081","28,247"],["47","61,769","31,152","30,617"],["48","65,019","32,616","32,403"],["49","64,714","32,455","32,259"],["50","64,279","32,149","32,130"],["51","64,267","32,313","31,954"],["52","62,609","31,891","30,718"],["53","62,064","31,757","30,307"],["54","63,678","32,695","30,983"],["55","45,499","23,327","22,172"],["56","58,005","30,070","27,935"],["57","53,097","27,315","25,782"],["58","49,974","25,860","24,114"],["59","47,100","24,077","23,023"],["60","44,242","22,858","21,384"],["61","42,992","21,791","21,201"],["62","41,258","21,209","20,049"],["63","40,281","20,366","19,915"],["64","37,194","18,530","18,664"],["65","37,531","18,849","18,682"],["66","38,123","19,002","19,121"],["67","37,573","18,561","19,012"],["68","38,321","18,604","19,717"],["69","41,315","20,175","21,140"],["70","42,491","20,844","21,647"],["71","45,684","21,941","23,743"],["72","52,446","24,940","27,506"],["73","51,122","23,970","27,152"],["74","51,020","23,969","27,051"],["75","34,532","15,947","18,585"],["76","31,276","14,225","17,051"],["77","37,707","16,814","20,893"],["78","39,516","17,388","22,128"],["79","37,337","16,392","20,945"],["80","36,689","15,774","20,915"],["81","32,916","14,015","18,901"],["82","27,961","11,848","16,113"],["83","25,738","11,075","14,663"],["84","27,106","11,103","16,003"],["85","24,536","9,690","14,846"],["86","23,522","9,187","14,335"],["87","19,165","7,195","11,970"],["88","17,655","6,309","11,346"],["89","15,544","5,370","10,174"],["90","13,113","4,269","8,844"],["91","10,844","3,431","7,413"],["92","8,912","2,572","6,340"],["93","7,485","2,060","5,425"],["94","5,280","1,392","3,888"],["95","4,111","1,037","3,074"],["96","3,208","693","2,515"],["97","2,197","433","1,764"],["98","1,425","248","1,177"],["99","998","164","834"],["100","1,857","248","1,609"],["年齢不詳","98,789","53,720","45,069"]]}
        </script>
        
        <!-- 青葉区 2022年 -->
        <script id="aoba-data" type="application/json">
        {"last_modified":"2022-01-18 15:06:56 +0900","kijunbi":"令和4年1月1日現在","shiku":"青葉区","source_url":"https://www.city.yokohama.lg.jp/city-info/yokohamashi/tokei-chosa/portal/jinko/nenrei/suikei.files/22_hyo22.xlsx","kakusai_betsu":[["総数","311,146","150,136","161,010"],["0","2,051","1,071","980"],["1","2,072","1,064","1,008"],["2","2,196","1,121","1,075"],["3","2,293","1,196","1,097"],["4","2,414","1,227","1,187"],["5","2,479","1,255","1,224"],["6","2,633","1,334","1,299"],["7","2,647","1,368","1,279"],["8","2,775","1,430","1,345"],["9","2,804","1,413","1,391"],["10","2,691","1,385","1,306"],["11","2,881","1,469","1,412"],["12","2,856","1,464","1,392"],["13","2,894","1,490","1,404"],["14","2,889","1,486","1,403"],["15","2,867","1,455","1,412"],["16","2,901","1,449","1,452"],["17","3,082","1,583","1,499"],["18","3,144","1,641","1,503"],["19","3,497","1,775","1,722"],["20","3,950","2,119","1,831"],["21","4,149","2,125","2,024"],["22","3,895","1,969","1,926"],["23","3,863","1,895","1,968"],["24","3,323","1,577","1,746"],["25","3,181","1,492","1,689"],["26","3,007","1,391","1,616"],["27","3,016","1,348","1,668"],["28","2,721","1,277","1,444"],["29","2,834","1,326","1,508"],["30","2,823","1,351","1,472"],["31","2,780","1,347","1,433"],["32","2,657","1,310","1,347"],["33","3,021","1,482","1,539"],["34","2,954","1,420","1,534"],["35","3,118","1,495","1,623"],["36","3,341","1,556","1,785"],["37","3,474","1,692","1,782"],["38","3,513","1,760","1,753"],["39","3,603","1,727","1,876"],["40","3,674","1,777","1,897"],["41","3,815","1,831","1,984"],["42","4,132","1,949","2,183"],["43","4,171","2,044","2,127"],["44","4,302","2,044","2,258"],["45","4,559","2,185","2,374"],["46","4,707","2,252","2,455"],["47","5,011","2,348","2,663"],["48","5,446","2,578","2,868"],["49","5,323","2,497","2,826"],["50","5,313","2,469","2,844"],["51","5,590","2,556","3,034"],["52","5,608","2,606","3,002"],["53","5,826","2,776","3,050"],["54","5,940","2,904","3,036"],["55","4,334","2,127","2,207"],["56","5,568","2,784","2,784"],["57","5,062","2,512","2,550"],["58","4,733","2,355","2,378"],["59","4,538","2,239","2,299"],["60","4,023","2,116","1,907"],["61","3,874","1,948","1,926"],["62","3,744","1,914","1,830"],["63","3,610","1,795","1,815"],["64","3,301","1,617","1,684"],["65","3,199","1,623","1,576"],["66","3,067","1,469","1,598"],["67","2,960","1,416","1,544"],["68","3,045","1,443","1,602"],["69","3,104","1,449","1,655"],["70","3,202","1,550","1,652"],["71","3,338","1,555","1,783"],["72","4,048","1,824","2,224"],["73","3,865","1,794","2,071"],["74","3,838","1,825","2,013"],["75","2,723","1,258","1,465"],["76","2,365","1,067","1,298"],["77","2,795","1,283","1,512"],["78","2,780","1,284","1,496"],["79","2,741","1,252","1,489"],["80","2,539","1,108","1,431"],["81","2,255","1,019","1,236"],["82","1,883","847","1,036"],["83","1,819","807","1,012"],["84","1,838","764","1,074"],["85","1,752","704","1,048"],["86","1,619","679","940"],["87","1,341","542","799"],["88","1,255","446","809"],["89","1,177","406","771"],["90","915","314","601"],["91","852","288","564"],["92","647","167","480"],["93","640","165","475"],["94","423","107","316"],["95","362","85","277"],["96","283","56","227"],["97","183","36","147"],["98","126","19","107"],["99","92","14","78"],["100","182","27","155"],["年齢不詳","6,400","3,886","2,514"]]}
        </script>
        
        <!-- 西区 2022年 -->
        <script id="nishi-data" type="application/json">
        {"last_modified":"2022-01-18 15:06:56 +0900","kijunbi":"令和4年1月1日現在","shiku":"西区","source_url":"https://www.city.yokohama.lg.jp/city-info/yokohamashi/tokei-chosa/portal/jinko/nenrei/suikei.files/22_hyo22.xlsx","kakusai_betsu":[["総数","104,483","52,764","51,719"],["0","759","385","374"],["1","704","368","336"],["2","752","369","383"],["3","758","394","364"],["4","799","407","392"],["5","803","384","419"],["6","783","415","368"],["7","767","389","378"],["8","781","408","373"],["9","753","364","389"],["10","743","358","385"],["11","745","376","369"],["12","726","383","343"],["13","695","374","321"],["14","695","351","344"],["15","644","325","319"],["16","674","351","323"],["17","653","327","326"],["18","683","362","321"],["19","732","371","361"],["20","833","426","407"],["21","942","440","502"],["22","993","493","500"],["23","1,273","639","634"],["24","1,460","752","708"],["25","1,496","771","725"],["26","1,567","817","750"],["27","1,585","842","743"],["28","1,497","797","700"],["29","1,524","805","719"],["30","1,497","781","716"],["31","1,548","791","757"],["32","1,434","705","729"],["33","1,517","767","750"],["34","1,510","811","699"],["35","1,556","815","741"],["36","1,590","818","772"],["37","1,632","903","729"],["38","1,609","845","764"],["39","1,622","802","820"],["40","1,606","836","770"],["41","1,634","844","790"],["42","1,589","831","758"],["43","1,693","871","822"],["44","1,654","833","821"],["45","1,759","917","842"],["46","1,857","949","908"],["47","1,955","992","963"],["48","1,872","951","921"],["49","1,897","945","952"],["50","1,881","947","934"],["51","1,831","950","881"],["52","1,770","898","872"],["53","1,735","937","798"],["54","1,735","918","817"],["55","1,332","724","608"],["56","1,475","795","680"],["57","1,430","725","705"],["58","1,270","662","608"],["59","1,266","659","607"],["60","1,120","592","528"],["61","1,046","523","523"],["62","1,110","578","532"],["63","1,062","537","525"],["64","940","456","484"],["65","899","479","420"],["66","946","474","472"],["67","890","441","449"],["68","849","416","433"],["69","964","492","472"],["70","943","449","494"],["71","994","516","478"],["72","1,118","558","560"],["73","1,162","540","622"],["74","1,145","513","632"],["75","711","338","373"],["76","623","281","342"],["77","819","341","478"],["78","749","344","405"],["79","708","310","398"],["80","693","285","408"],["81","669","254","415"],["82","532","222","310"],["83","495","190","305"],["84","527","196","331"],["85","489","181","308"],["86","509","184","325"],["87","442","150","292"],["88","372","123","249"],["89","354","126","228"],["90","293","88","205"],["91","251","71","180"],["92","205","75","130"],["93","142","39","103"],["94","122","29","93"],["95","83","16","67"],["96","85","15","70"],["97","44","6","38"],["98","21","7","14"],["99","17","4","13"],["100","31","0","31"],["年齢不詳","2,734","1,860","874"]]}
        </script>        
    </div>

    <!-- JavaScriptファイルの読み込み -->
    <script src="js/pyramid-svg.js"></script>
    
    <script>
        let currentRenderer = null;
        let isSVGMode = true;
        let currentOptions = {
            showNumbers: true,
            showGrid: true
        };

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadDemoData();
            
            // バーの高さスライダーのイベントリスナーを設定
            //const barHeightSlider = document.getElementById('barHeightSlider');
            //barHeightSlider.addEventListener('input', updateBarHeightValue);
        });


        // 描画エンジンの切り替え
        function toggleRenderer() {
            isSVGMode = !isSVGMode;
            const button = document.getElementById('toggleRenderer');
            
            if (isSVGMode) {
                button.textContent = 'SVG描画';
                button.classList.add('active');
                document.getElementById('status').textContent = 'SVG描画エンジンが有効です';
            } else {
                button.textContent = 'HTML描画';
                button.classList.remove('active');
                document.getElementById('status').textContent = 'HTML描画エンジンが有効です（※このデモではSVGのみ対応）';
            }
            
            // 現在のデータで再描画
            loadDemoData();
        }

        // ユニットサイズの変更
        let unitSize =null;
        let barHeight =null;
        const uin = document.getElementById('uin');
        const uout = document.getElementById('uout');
        const radio = document.getElementById('unitsize');
        uin.addEventListener('click', () => {
          if(unitSize === null) {
            unitSize = currentRenderer.options.unitSize;
            barHeight = currentRenderer.options.barHeight;
          }
          if(radio.checked) {
            unitSize = unitSize+0.001;
          } else {
            barHeight = barHeight+0.1;
          }
          currentRenderer.resize({"unitSize" : unitSize, "barHeight" : barHeight});
        });
        uout.addEventListener('click', () => {
          if(unitSize === null) {
            unitSize = currentRenderer.options.unitSize;
            barHeight = currentRenderer.options.barHeight;
          }
          if(radio.checked) {
            unitSize = unitSize-0.001;
          } else {
            barHeight = barHeight-0.1;
          }
          currentRenderer.resize({"unitSize" : unitSize, "barHeight" : barHeight});
        });

        // ピラミッドサイズの変更
        const zin = document.getElementById('zin');
        const zout = document.getElementById('zout');
        const zoom = document.getElementById('scaleLabel');
        let scale = 1;
        zin.addEventListener('click', () => {
          scale = Math.min(1.5, scale+0.01);
          zoom.value = scale;
          currentRenderer.resize({"scale" : scale});
          zoom.textContent = (scale*100).toFixed(0) + '%';
        });
        zout.addEventListener('click', () => {
          scale = Math.max(0.25, scale - 0.01);
          zoom.value = scale;
          currentRenderer.resize({"scale" : scale});
          zoom.textContent = (scale*100).toFixed(0) + '%';
        });

        function changePyramidSize() {
            const scale = parseFloat(document.getElementById('pyramidSize').value);
            if (currentRenderer) {
                currentRenderer.resize({"scale" : scale});
            }
        }

        // 人数表示の切り替え
        function toggleNumbers() {
            currentOptions.showNumbers = !currentOptions.showNumbers;
            if (currentRenderer) {
                currentRenderer.updateOptions({ showNumbers: currentOptions.showNumbers });
            }
        }

        // グリッド表示の切り替え
        function toggleGrid() {
            currentOptions.showGrid = !currentOptions.showGrid;
            if (currentRenderer) {
                currentRenderer.updateOptions({ showGrid: currentOptions.showGrid });
            }
        }
        
        // ハイブリッドリサイズの適用
        function applyHybridResize() {
            if (!currentRenderer) return;
            
            const barHeight = parseFloat(document.getElementById('barHeightSlider').value);
            const newHeight = Math.floor((101 * barHeight) + 100); // 101年齢 × barHeight + 100pxマージン
            
            currentRenderer.resize({ barHeight: barHeight, height: newHeight });
        }
        
        // バーの高さスライダーの値表示更新
        function updateBarHeightValue() {
            const value = document.getElementById('barHeightSlider').value;
            document.getElementById('barHeightValue').textContent = value + 'px';
        }

        // デモデータの読み込み
        function loadDemoData() {
            const selectedData = document.getElementById('demoData').value;
            const dataScript = document.getElementById(selectedData + '-data');
            
            if (!dataScript) {
                console.error('データが見つかりません:', selectedData);
                return;
            }

            try {
                const data = JSON.parse(dataScript.textContent);
                renderPyramid(data);
            } catch (error) {
                console.error('データの解析に失敗しました:', error);
            }
        }

        // ピラミッドの描画
        function renderPyramid(data) {
            if (!isSVGMode) {
                document.getElementById('pyramid-container').innerHTML = 
                    '<p style="text-align: center; padding: 50px;">このデモではSVG描画のみ対応しています</p>';
                return;
            }

            const options = {
                ...currentOptions,
                scaleMode: document.getElementById('scaleMode').value
            };

            try {
                currentRenderer = new PyramidSVGRenderer('pyramid-container', options);
                currentRenderer.render(data.kakusai_betsu);
                
                document.getElementById('status').textContent = 
                    `SVG描画エンジンが有効です - ${data.shiku} (${data.kijunbi})`;
            } catch (error) {
                console.error('描画に失敗しました:', error);
                document.getElementById('pyramid-container').innerHTML = 
                    '<p style="text-align: center; padding: 50px; color: red;">描画エラーが発生しました</p>';
            }
        }
    </script>
</body>
</html>

